// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  password      String
  name          String?
  role          UserRole @default(USER)
  emailVerified Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  blogPosts BlogPost[]
  events    Event[]

  @@map("users")
}

enum UserRole {
  USER
  ADMIN
}

model BlogPost {
  id          String  @id @default(cuid())
  slug        String  @unique
  title       String
  subtitle    String?
  description String?

  // Content - stored as JSON for flexibility
  content         Json // Array of content blocks (heading, paragraph, list, etc.)
  tableOfContents Json? // Array of TOC items with id, title, level

  // Media
  heroImage     String?
  featuredImage String?

  // Metadata
  readTime    String?
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Status
  status   BlogPostStatus @default(DRAFT)
  featured Boolean        @default(false)

  // SEO
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?

  // Relations
  authorId String
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  categories BlogCategory[]
  tags       String[]       @default([]) // Array of tag strings

  // Multi-language support
  language     String                @default("en") // "en" or "tr"
  translations BlogPostTranslation[]

  @@index([slug])
  @@index([status, publishedAt])
  @@index([authorId])
  @@index([language])
  @@map("blog_posts")
}

model BlogCategory {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  posts BlogPost[]

  @@map("blog_categories")
}

model BlogPostTranslation {
  id              String  @id @default(cuid())
  language        String // "en" or "tr"
  title           String
  subtitle        String?
  description     String?
  content         Json
  tableOfContents Json?

  blogPostId String
  blogPost   BlogPost @relation(fields: [blogPostId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([blogPostId, language])
  @@map("blog_post_translations")
}

enum BlogPostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum EventCategory {
  WEBINAR
  WORKSHOP
  QNA
  NETWORKING
  OTHER
}

enum LocationType {
  IN_PERSON
  ONLINE
  HYBRID
}

enum EventStatus {
  DRAFT
  PUBLISHED
  CANCELLED
  ARCHIVED
}

enum EventDisplayStatus {
  UPCOMING
  TODAY
  PAST
  FULL
  CANCELLED
}

enum EventColor {
  BLUE
  RED
}

model Event {
  id          String  @id @default(cuid())
  slug        String  @unique
  title       String
  subtitle    String?
  description String? @db.Text

  // Date & Time
  startDate DateTime
  endDate   DateTime?
  startTime String?
  endTime   String?
  timezone  String?   @default("EST")

  // Location
  locationType LocationType @default(ONLINE)
  address      String?
  city         String?
  province     String?
  country      String?
  meetingLink  String?

  // Event Details
  type         String // Display type: "Online Webinar", "In-Person Event"
  category     EventCategory @default(WEBINAR)
  color        EventColor    @default(BLUE)
  whatToExpect Json? // Array of strings
  dressCode    String?       @db.Text
  specialNotes String?       @db.Text

  // Registration
  capacity             Int?
  registeredCount      Int       @default(0)
  registrationRequired Boolean   @default(false)
  registrationUrl      String?
  registrationDeadline DateTime?

  // Media
  coverImage    String?
  heroImage     String?
  featuredImage String?
  photos        Json? // Array of image URLs
  videos        Json? // Array of {thumbnail: string, url: string}

  // Status & Publishing
  status      EventStatus @default(DRAFT)
  featured    Boolean     @default(false)
  publishedAt DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // SEO
  metaTitle       String?
  metaDescription String? @db.Text
  metaKeywords    String?

  // Calendar
  calendarUrl String?

  // Multi-language
  language     String             @default("en")
  translations EventTranslation[]

  // Relations
  authorId String
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([slug])
  @@index([status, publishedAt])
  @@index([category])
  @@index([startDate])
  @@index([language])
  @@map("events")
}

model EventTranslation {
  id           String  @id @default(cuid())
  language     String // "en" or "tr"
  title        String
  subtitle     String?
  description  String? @db.Text
  whatToExpect Json?
  dressCode    String? @db.Text
  specialNotes String? @db.Text

  eventId String
  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([eventId, language])
  @@map("event_translations")
}
